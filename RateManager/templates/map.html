{% extends "base.html" %}
{% block content %}
  <h2>Mapeo de columnas</h2>
  <p>Asocia las columnas del archivo fuente con las columnas requeridas para el CSV final.</p>

  <form method="post" action="/generate">
    <input type="hidden" name="filepath" value="{{filepath}}">

    <table class="table">
      <thead>
        <tr>
          <th>Campo requerido</th>
          <th>Columna origen</th>
          <th>Valor por defecto</th>
        </tr>
      </thead>
      <tbody>
        {% for field in required_fields %}
        <tr>
          <td>{{field}}</td>
          <td>
            <select class="form-select map-select" name="map_{{field}}">
              <option value="">-- Ninguno --</option>
              {% for c in columns %}
                <option value="{{c}}">{{c}}</option>
              {% endfor %}
              <option value="__DEFAULT__">Usar valor por defecto</option>
            </select>
          </td>
          <td>
            <input type="text" class="form-control def-input" name="def_{{field}}" placeholder="(opcional)">
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Descuento (%)</label>
        <input class="form-control" type="number" name="discount" step="0.01" value="0">
      </div>
      <div class="col-md-6">
        <label class="form-label">Ganancia (%)</label>
        <input class="form-control" type="number" name="gain" step="0.01" value="0">
      </div>
    </div>

    <button class="btn btn-success" type="submit">Generar CSV</button>
  </form>

  <hr>
  <p>Columnas detectadas: <strong>{{ columns|join(', ') }}</strong></p>
{% endblock %}
